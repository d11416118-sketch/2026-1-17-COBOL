========================================================================
           COBOL x Python 混合架構點餐系統 - 使用者操作手冊
========================================================================

本手冊將引導您在新電腦 (Linux/WSL 環境) 上部署並執行本系統。
系統架構：前端 (HTML/JS) + 後端 (Python Flask) + 核心運算 (COBOL)。

目錄：
1. [準備工作] 檔案確認
2. [環境安裝] 安裝必要軟體
3. [專案設定] 編譯 COBOL 與初始化
4. [啟動系統] 執行伺服器
5. [操作說明] 顧客端、店員端與商品管理
6. [進階功能] 手機連線方式 (WSL 專用)
7. [疑難排解] 常見錯誤處理

------------------------------------------------------------------------
1. [準備工作] 檔案確認
------------------------------------------------------------------------
請確認您的專案資料夾內包含以下檔案與目錄：

📂 專案資料夾
 ├── app.py           (Python 主程式 - 含打卡與商品管理功能)
 ├── drink.cbl        (COBOL 原始碼)
 ├── index.html       (顧客介面 - 自動讀取資料庫菜單)
 ├── admin.html       (後台介面 - 含打卡與商品上下架)
 └── static/          (圖片資料夾 - 上傳的圖片會存在這)
      ├── black_tea.png
      └── (其他預設圖片...)

------------------------------------------------------------------------
2. [環境安裝] 安裝必要軟體
------------------------------------------------------------------------
請開啟終端機 (Terminal)，依序輸入以下指令來安裝 Python、Flask 網頁框架與 COBOL 編譯器。

(1) 更新系統清單：
    sudo apt update

(2) 安裝所有核心套件 (一次安裝完成)：
    sudo apt install python3 python3-pip python3-flask gnucobol -y
    sudo apt install psmisc -y   (選用：安裝 killall 指令，方便關閉程式)

    * 注意：我們使用 apt 安裝 flask 以避免權限錯誤。

------------------------------------------------------------------------
3. [專案設定] 編譯 COBOL 與初始化
------------------------------------------------------------------------
在執行 Python 之前，必須先編譯 COBOL 程式，並清理舊資料庫。

(1) 進入您的專案資料夾：
    cd 您的專案路徑

(2) 編譯 COBOL 核心：
    cobc -x -o drink.exe drink.cbl

(3) 初始化資料庫 (重要！)：
    rm -f shop.db

    * 刪除後，程式啟動時會自動建立含「打卡」與「商品」功能的新資料庫，
      並自動補回預設的 5 種飲料。

------------------------------------------------------------------------
4. [啟動系統] 執行伺服器
------------------------------------------------------------------------
(1) 在終端機輸入：
    python3 app.py

(2) 當您看到 "Running on http://0.0.0.0:5000" 代表啟動成功。

    * 注意：若出現 "Address already in use"，請參考第 7 節疑難排解。

------------------------------------------------------------------------
5. [操作說明] 顧客端、店員端與商品管理
------------------------------------------------------------------------
請開啟電腦上的瀏覽器 (Chrome/Edge)，輸入以下網址：

【顧客自助點餐端】(給客人用)
網址：http://127.0.0.1:5000/
功能：
  1. 菜單現在是「動態」的，會顯示後台最新上架的商品。
  2. 點擊卡片選擇「甜度」、「冰塊」與「數量」。
  3. 加入購物車後，點擊「確認結帳」。

【店員後台管理端】(給老闆/員工用)
網址：http://127.0.0.1:5000/admin

[區域 A] 員工打卡 (右上角)
  - 輸入員工姓名，點擊「上班」或「下班」。
  - 紀錄會顯示在右側的「📋 打卡紀錄」列表中。

[區域 B] 訂單製作 (左側)
  - 待製作區 (Pending)：看到黃色訂單，做完後按「OK / 出餐」。
  - 已完成區 (History)：查看今日營收紀錄。

[區域 C] 商品上下架管理 (右下角 - 新功能 ✨)
  - **上架新商品**：
    1. 輸入飲料名稱 (如：超級特調)。
    2. 輸入價格。
    3. 選擇一張圖片 (支援 png/jpg)。
    4. 按下「➕ 上架」，顧客端重整後就會立刻看到。
  - **下架商品**：
    在列表中找到該商品，點擊紅色的「下架」按鈕即可刪除。

------------------------------------------------------------------------
6. [進階功能] 手機連線方式 (WSL 專用)
------------------------------------------------------------------------
由於使用 WSL (Windows 子系統)，手機連線需要設定「搭橋」。

(1) 查詢 Windows IP (門牌號碼)：
    回到 Windows 桌面，打開 PowerShell 輸入 `ipconfig`。
    記下 IPv4 位址 (例如：192.168.0.135)。

(2) 查詢 Linux IP (內部房間號)：
    在黑畫面終端機輸入 `ip a`。
    記下 eth0 的 inet 位址 (例如：172.28.x.x)。

(3) 設定搭橋與防火牆 (僅需設定一次，重開機後若 IP 變動需重設)：
    以「系統管理員身分」開啟 Windows PowerShell，執行以下兩行：
    
    netsh interface portproxy add v4tov4 listenport=5000 listenaddress=0.0.0.0 connectport=5000 connectaddress=[填入上面的Linux IP]
    
    New-NetFirewallRule -DisplayName "Allow Flask" -Direction Inbound -LocalPort 5000 -Protocol TCP -Action Allow

(4) 手機連線：
    手機瀏覽器輸入：http://[Windows IP]:5000

------------------------------------------------------------------------
7. [疑難排解] 常見錯誤處理
------------------------------------------------------------------------
Q1: 出現 "Address already in use" (Port 5000 被佔用) ?
A1: 代表上次程式沒關好。請執行 `killall python3` (若有裝) 或手動殺掉行程。
    指令：ps aux | grep python  (找出 PID) -> kill -9 [PID]

Q2: 上傳圖片後顯示失敗？
A2: 請確認檔名副檔名為 png, jpg, jpeg，且檔名不要包含特殊符號。

Q3: 手機連不上網頁 ?
A3: 
    1. 確認電腦設為「永不睡眠」(螢幕可關，主機不能睡)。
    2. 確認已依第 6 節步驟設定 `netsh` 搭橋。
    3. 確認手機與電腦連同一個 Wi-Fi。

Q4: 剛上架的商品圖片看不到 (破圖)？
A4: 請確認圖片已成功上傳至 static 資料夾。若是中文檔名，建議改為英文檔名再上傳。

========================================================================